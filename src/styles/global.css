@tailwind base;
@tailwind components;
@tailwind utilities;

/* Custom prose colors */
.prose {
  @apply prose-slate;
}

/* WordPress content tweaks */
/* Responsive gallery grid for classic WP galleries (blocks and shortcodes) */
.prose .wp-block-gallery,
.prose .blocks-gallery-grid,
.prose .gallery {
  display: grid;
  gap: 0.75rem;
}

/* Auto-fit columns with a reasonable min size */
.prose .wp-block-gallery,
.prose .blocks-gallery-grid {
  /* Make thumbs larger and uniform (square) */
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  list-style: none;
  padding-left: 0;
  margin: 0;
}

/* Legacy .gallery may use inline width hints; prefer 3-4 cols on larger screens */
@media (min-width: 640px) {
  .prose .gallery {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
}
@media (min-width: 768px) {
  .prose .gallery {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
}
@media (min-width: 1024px) {
  .prose .gallery {
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }
}

/* Gallery items normalize */
.prose .wp-block-gallery figure,
.prose .blocks-gallery-item,
.prose .gallery-item,
.prose .gallery .gallery-item {
  margin: 0;
}

/* Prevent WP inline widths from shrinking items */
.prose .blocks-gallery-item,
.prose .gallery .gallery-item {
  width: 100% !important;
  max-width: none !important;
}
.prose .blocks-gallery-item > figure,
.prose .gallery .gallery-item > figure {
  width: 100% !important;
}

/* Base image styling (non-gallery) */
.prose .wp-block-gallery img,
.prose .blocks-gallery-item img,
.prose .gallery-item img {
  display: block;
}

/* Consistent square tiles without overlapping captions: reserve space with ::before */
.prose .wp-block-gallery .blocks-gallery-item figure,
.prose .gallery .gallery-item figure {
  position: relative;
  margin: 0;
}
.prose .wp-block-gallery .blocks-gallery-item figure::before,
.prose .gallery .gallery-item figure::before {
  content: "";
  display: block;
  padding-top: 100%; /* 1:1 square area for the image */
  border-radius: 0.5rem;
}
.prose .wp-block-gallery .blocks-gallery-item img,
.prose .gallery .gallery-item img {
  position: absolute;
  inset: 0;
  width: 100% !important;
  height: 100% !important;
  object-fit: cover;
  display: block;
  border-radius: 0.5rem; /* match rounded-lg */
}
/* Captions sit below the image area so they won't be overlapped */
.prose .blocks-gallery-item figcaption,
.prose .gallery .gallery-item figcaption {
  @apply text-sm text-slate-600 mt-2;
}

/* Optional: captions */
.prose .wp-element-caption,
.prose .gallery-caption {
  @apply text-sm text-slate-600 mt-1;
}

/* Ensure block images inside content don't overflow and have consistent rounding */
.prose :where(img) {
  border-radius: 0.5rem;
}

/* ========================= */
/* Scroll reveal (generic)   */
/* ========================= */
.reveal-on-scroll {
  opacity: 0;
  transform: translateY(42px);
  transition: opacity .75s cubic-bezier(.16,.84,.44,1), transform .75s cubic-bezier(.16,.84,.44,1);
  will-change: opacity, transform;
}
.reveal-on-scroll.is-visible {
  opacity: 1;
  transform: translateY(0);
}
@media (prefers-reduced-motion: reduce) {
  .reveal-on-scroll { transition: none; transform: none; opacity: 1; }
}

/* Default: inline images in post content are smaller and centered */
.prose .wp-content img {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 100%;
  max-width: 680px; /* smaller on page; zoom on click via lightbox */
  height: auto;
  cursor: zoom-in;
}

/* ========================= */
/* Video embeds (WordPress)  */
/* ========================= */
/* Make videos fill the paragraph width and be responsive */
.prose figure.wp-block-embed.is-type-video,
.prose .wp-block-video {
  margin-top: 1.25rem;
  margin-bottom: 1.25rem;
}

.prose figure.wp-block-embed .wp-block-embed__wrapper,
.prose .wp-block-video {
  position: relative;
}

.prose figure.wp-block-embed .wp-block-embed__wrapper::before,
.prose .wp-block-video::before {
  content: "";
  display: block;
  padding-top: 56.25%; /* 16:9 */
}

.prose figure.wp-block-embed .wp-block-embed__wrapper > iframe,
.prose .wp-block-video > video {
  position: absolute;
  inset: 0;
}

.prose figure.wp-block-embed.is-type-video .wp-block-embed__wrapper > iframe,
.prose .wp-content iframe[src*="youtube"],
.prose .wp-content iframe[src*="vimeo"],
.prose .wp-content iframe[src*="player.vimeo"],
.prose .wp-content iframe[src*="dailymotion"],
.prose .wp-content video {
  width: 100% !important;
  max-width: none !important;
  aspect-ratio: 16 / 9;
  height: auto !important;
  display: block;
  border-radius: 0.5rem;
}

/* Caption box below video (uses Gutenberg figcaption) */
.prose figure.wp-block-embed figcaption,
.prose .wp-block-video figcaption {
  @apply text-sm text-slate-700 bg-slate-100 border border-slate-200 rounded-md p-3 mt-2;
}

/* Respect Gutenberg columns-X classes */
.prose .wp-block-gallery.columns-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
.prose .wp-block-gallery.columns-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
.prose .wp-block-gallery.columns-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
.prose .wp-block-gallery.columns-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
.prose .wp-block-gallery.columns-5 { grid-template-columns: repeat(5, minmax(0, 1fr)); }
.prose .wp-block-gallery.columns-6 { grid-template-columns: repeat(6, minmax(0, 1fr)); }

/* Prefer large, uniform tiles for legacy .gallery as well */
.prose .gallery {
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}

/* ========================= */
/* Gutenberg Columns (WP)    */
/* ========================= */
/* Base container: flex with wrap and reasonable gap */
.prose .wp-block-columns {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem; /* can be adjusted or mapped to --wp--style--block-gap if needed */
  margin-top: 1rem;
  margin-bottom: 1rem;
}

/* Columns stack by default on small screens */
.prose .wp-block-columns > .wp-block-column {
  flex: 1 1 100%;
  min-width: 0;
}

/* Do not constrain images inside columns to 680px; use full column width */
.prose .wp-block-columns img {
  max-width: 100% !important;
}

/* At WP’s default breakpoint (≈782px), lay out columns side by side */
@media (min-width: 782px) {
  /* Equal distribution by default */
  .prose .wp-block-columns > .wp-block-column {
    flex: 1 1 0%;
  }
  /* Respect the explicit number of columns when WP adds has-N-columns */
  .prose .wp-block-columns.has-2-columns > .wp-block-column:not([style*="flex-basis"]) { flex-basis: 50%; }
  .prose .wp-block-columns.has-3-columns > .wp-block-column:not([style*="flex-basis"]) { flex-basis: 33.3333%; }
  .prose .wp-block-columns.has-4-columns > .wp-block-column:not([style*="flex-basis"]) { flex-basis: 25%; }
  .prose .wp-block-columns.has-5-columns > .wp-block-column:not([style*="flex-basis"]) { flex-basis: 20%; }
  .prose .wp-block-columns.has-6-columns > .wp-block-column:not([style*="flex-basis"]) { flex-basis: 16.6667%; }
}

/* If the editor set "is-not-stacked-on-mobile", keep columns on mobile too */
.prose .wp-block-columns.is-not-stacked-on-mobile > .wp-block-column {
  flex: 1 1 50%;
}
@media (max-width: 781.98px) {
  .prose .wp-block-columns.is-not-stacked-on-mobile.has-3-columns > .wp-block-column { flex-basis: 33.3333%; }
  .prose .wp-block-columns.is-not-stacked-on-mobile.has-4-columns > .wp-block-column { flex-basis: 25%; }
}
