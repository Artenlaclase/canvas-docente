---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import Gallery from "../../components/Gallery.astro";
import TechniqueFilter from "../../components/TechniqueFilter.astro";
import { getCollection } from 'astro:content';
import { getUnique, sortDescNumeric } from "../../utils/imageTools";

const all = await getCollection('galeria');
const query = Astro.url.searchParams;
const technique = query.get('technique') ?? '';
const yearParam = query.get('year') ?? '';

let filtered = all;
if (technique) filtered = filtered.filter((p) => p.data.technique === technique);
if (yearParam) filtered = filtered.filter((p) => String(p.data.year) === String(yearParam));

const techniques = getUnique(all.map((p) => p.data.technique));
const years = sortDescNumeric(getUnique(all.map((p) => p.data.year)));
---
<BaseLayout title="Galería | Canvas Docente">
  <Fragment slot="header"><Header /></Fragment>
  <h1 class="text-2xl font-semibold mb-4">Galería</h1>
  <TechniqueFilter techniques={techniques} selected={technique} years={years} selectedYear={yearParam} />
  <Gallery items={filtered} />
</BaseLayout>
